<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Tools EasyAnalysis: #Tutorial to use the Analysis class</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tools EasyAnalysis
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">#Tutorial to use the <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> class </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This class is intended to be a RooFit wrapper to simplify its use at least is some situations. It can do three things:</p><ul>
<li>manipulate and hold data in the form of TTree, allows to do cuts, add variables, etc</li>
<li>build models and fit data</li>
<li>use the information from a fit (e.g. to calculate the sWeight)</li>
</ul>
<p>A full doxygen for the class can be found at <a href="http://test-lhcbbham.web.cern.ch/test-lhcbbham/d7/dae/classAnalysis.html">http://test-lhcbbham.web.cern.ch/test-lhcbbham/d7/dae/classAnalysis.html</a></p>
<h2>PART 1 - Constructors and handling data</h2>
<p>The base constructor for the class is:</p>
<p>``` <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> (TString _name, TString _title, <a class="el" href="classTreeReader.html" title="The class allows to load a ROOT TTree object and easily manipulate information. ">TreeReader</a> *reader, TCut *_cuts, RooRealVar *_var=NULL, string _w="") ```</p>
<p>Where:</p><ul>
<li>"_name" it's the name for the object and must be unique.</li>
<li>"_title" it's just a title.</li>
<li>"reader" it's a <a class="el" href="classTreeReader.html" title="The class allows to load a ROOT TTree object and easily manipulate information. ">TreeReader</a> object which contains a TChain and holds pointers to all its branches.</li>
<li>"_cuts" are cuts that you want to be applied no matter what</li>
<li>"_var" it's the observable to be fitted, it's not compulsory to have one if you just want to apply cuts.</li>
<li>"_w" it's the name of a branch of the TChain to be interpreted as weight</li>
</ul>
<p>In case your tree is in a single file you can also use the simplified constructor</p>
<p>``` <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> (TString _name, TString _title, string treename, string filename, RooRealVar *_var=NULL, TCut *_cuts=NULL, string _w="") ```</p>
<ul>
<li>"treename" it's the name of a tree in a file</li>
<li>"filename" it's the file containing that tree</li>
</ul>
<p>Other two constructors for particular situations are available (see the doxygen)</p>
<h3>Initialising: (VERY IMPORTANT)</h3>
<p>Before using the object. After filling information on data but also on the model. You need to initialise it by using <code><a class="el" href="classAnalysis.html#a64b19ed503b12072cc7a803f76b6f84b">Analysis::Initialize()</a></code>. e.g. This is necessary before applyCuts() or before Fit().</p>
<p>Options: By default "-exp-namepar" (Always divided by dashes!)</p>
<ul>
<li>"-exp" : adds automatically and exponential bkg component</li>
<li>"-namepar" : appends the object name to the model name</li>
<li>"-nobkg" : ignores the bkg information and runs as signal only</li>
</ul>
<hr/>
<h2>PART 1 - Building models and fitting</h2>
<p>You can add a model using the SetSignal() and addBkgComponent() method.</p>
<h3>Create PDFs: SetSignal()</h3>
<p>``` ana-&gt;SetSignal (T *_sig, double _nsig=0, string opt="-namepar", Str2VarMap myvars=Str2VarMap(), string weight="") ```</p>
<p>Arguments:</p><ul>
<li>The first argument, "T*_sig", is the source of the signal shape. "T" can be any of these types: string, a TTree, a TH1, or a RooAbsPdf<ul>
<li><p class="startli">string : This is a string that describes a model. Available models are:</p>
<p class="startli"><b>Gauss, DGauss, CB, DCB, DCB_OST, DCB_Sn, Poly, Cheb, Argus, CBGauss, Exp</b></p>
<p class="startli">To any model a gaussian can be added by adding "AndGauss" to its name e.g. CBAndGauss returns the sum of a gaussian and a CB N.B.: CBAndGauss and CBGauss are different because the latter had the "m" parameter in common between Gauss and CB DCB_OST means DCB with Opposite Side Tails, and DCB_Sn means Same "n" (the tail slope if the 2 CB is kept in common) You can also convolute any model with a gaussian adding ConvGauss to its name.</p>
<p class="startli">Then you can (it's not compulsory) specify parameters in the following way:</p>
<p class="startli">*"model-Xparam1[val,min,max]-param2[val,min,max]"*</p>
<p class="startli">Notice that an X in front of the name fixes the parameter. The min and max are not compulsory (there are defaults which may be good or not for you)</p>
<p class="startli">e.g. "DCB_Sn-Xm[5382,5000,5500]-s[10,5,20]-s2[20,10,50]-n[1,0,10]"</p>
<p class="startli">If you want to check which models are available and their parameters names they are listed in the last 3 functions in ModelBuilder.cpp</p>
</li>
</ul>
</li>
</ul>
<p>TTree : In this case the <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> object used the RooKeysPdf class to extract a smooth shape from the TTree N.B.: The observable you used in the constructor MUST be in the tree with the same name. For more fancy things see "opt".</p>
<ul>
<li>TH1 : In this case the RooHistPdf class is used instead</li>
<li>RooAbsPdf : If nothing above satisfies you you can buil a model of your own and give it to the fitter</li>
</ul>
<p>_nsig This is the yield connected to the signal. You can give it a double or a RooRealVar. If you give it a double it will build a RooRealVar following this rules _nsig &gt; 0 -&gt; is a RooRealVar with initial value "_nsig" _nsig &lt; 0 -&gt; is a RooRealVar with value "\_nsig" and fixed in the fit (the signal yield will not float)</p>
<ul>
<li>opt : This can be used for extra options: Using a TTree as source you can specify in the options "-s1" or "-s2" to change the resolution of the smoothing -v[var1,var2,...]-c[cuts] to apply a cut to the tree before extracting the distribution N.B.: In this case you must speficy in -v[] all variables needed for the cut</li>
<li><p class="startli">myvars : This is a Str2VarMap object (a map connecting RooRealVar's and their names) This can be used to use parameters of previous fits with all their properties. N.B.: It will override any parameter set in the name description</p>
<p class="startli">e.g. Let's imagine you need to fit your rare signal but the statistics is not enough to constrain a fully-free DCB Then you want to fit J/psi and use its parameters for the rare fit. </p><pre class="fragment">   ```
   Analysis * anaJpsi = new Analysis(...)
   Analysis * anaRare = new Analysis(...)
   anaJpsi-&gt;SetSignal(...);
   anaJpsi-&gt;addBkgCompnent(...);
   anaJpsi-&gt;Initialize("");
   anaJpsi-&gt;Fit();                                 //Fit Jpsi
   Str2VarMap jpsiPars = anaJpsi-&gt;GetSigParams();  //Retrieve parameters
   anaRare-&gt;SetSignal("...",50,"",jpsiPars);       //Use parameters.
   //This fits a resonant samples and used the parameters found for the rare fit
   ```
</pre></li>
</ul>
<h4>Backgrounds</h4>
<p>``` ana-&gt;addBkgComponent (const char *_name, T *_comp, double _frac=0, string opt="-namepar", Str2VarMap myvars=Str2VarMap(), string weight="") ```</p>
<p>To add a bkg component. As many as you like. There it is required to give the component an unique name "_name". Works very similar to SetSignal() so I won't repeat. One difference is the following:</p>
<p>"_frac" it's the current bkg component yield can be again a RooRealVar or a RooFormulaVar. Passing a RooFormulaVar can be useful if you want to bind 2 bkg yield together.</p>
<p>e.g. Let's say you know the ratio between Bd and Bs you expect. Then you can define the Bd and Bs yields as</p>
<p>``` RooRealVar * NBd = new RooRealVar("NBd",...) RooFormulaVar * NBs = new RooFormulaVar("NBs","somefactor * NBd",*NBd); ```</p>
<p>Then giving NBd and NBs to addBkgComponent() will happen that NBd is free in the fit and NBs linked to it.</p>
<p>As for the signal _frac &gt; 0 means free and _frac &lt; 0 means fixed but in addition if |_frac| &lt; 1. It is not interpreted as an absolute yield but as a fraction wrt of the signal yield.</p>
<h3>Fit</h3>
<p>``` ana-&gt;Fit(double min=0, double max=0., unsigned nbins=50, bool unbinned=false, string print="-range-log", TCut mycuts="") ```</p>
<p>After setting the model and initializing you can fit.</p>
<p>min,max: fitting interval, if min =&gt; max all available is used nbins: n of bins to use (if unbinned this is only for display) unbinned: true for unbinned fit print: Options (includes also all options of <a class="el" href="classModelBuilder.html#a6c698048ec3ebfabfb9dbd935d66ae82" title="Prints a plots with the model on it using the GetFrame() function. ">ModelBuilder::Print()</a> and GetFrame()) Here I report just the ones particular to Fit and a few others.</p><ul>
<li>"-quiet" -&gt; shell output minimized</li>
<li>"-sumW2err" -&gt; if weighted data errors shown reflect statistics of initial sample</li>
<li>"-log" -&gt; logarithmic plot</li>
<li>"-pulls" or</li>
<li>"-ANDpulls" -&gt; if data is inserted these add a pull histogram -pulls in other plot -ANDpulls under fit plot</li>
<li>"-range" -&gt; plots only the fitted range, otherwise all available is plot</li>
<li>"-noPlot" -&gt; doesn't print and only returns the frame</li>
<li>"-minos" -&gt; Enables MINOS for asymmetric errors cuts: cuts to make just before fitting</li>
</ul>
<p>After the fit a RooFitResult object is stored inside the analysis object and can be retrieved using GetFitRsult().</p>
<p>Notice that is not compulsory to use the standard function for fit. If you want to build you own fancy fitter you can use it on the data and models built like this:</p>
<p>``` myfancyfitter(ana-&gt;getModel(),ana-&gt;GetDataSet()) ```</p>
<h2>Just one example</h2>
<p>``` RooRealVar * MM = new RooRealVar("MM","MM",5300,5000,6000); <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * anaRare = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("my_ana","B0","myB0tree","myfile",MM) TCut cuts = "somecuts";</p>
<p>anaRare-&gt;SetSignal("DCB-Xm[3283]"); // Double Crystal Ball with mass parameter fixed to 3283 anaRare-&gt;SetSignal("Combinatorial","Exp-b[-0.005,-0.03,0.01]"); // Exponential with slope variable between -0.03 and 0.01 anaRare-&gt;Initialize(""); // Never forget this! anaRare-&gt;applyCuts(cuts); // Apply the cuts "cuts" (cuts is a (TCut *)) anaRare-&gt;Fit(5300,5800,50,true,"-minos-quiet") // Fit unbinned in the given interval using minos // The output will be fancy nice plots with legends and parameter boxes ```</p>
<hr/>
<h2>PART 2 :Handling data:</h2>
<h3>Apply cuts</h3>
<p>``` TTree * applyCuts (TCut _cuts=NULL, bool substtree=true, void(*addFunc)(<a class="el" href="classTreeReader.html" title="The class allows to load a ROOT TTree object and easily manipulate information. ">TreeReader</a> *, TTree *, bool)=NULL, double frac=1) ```</p>
<p>Applies the logical and between the cuts added in the constructor and the ones passed to the method. It returns a reduced TTree and by default it stores it in the object too. N.B.: The initial dataset will not be modified so you can reapply different cuts.</p>
<ul>
<li>substtree : The reduced tree is returned and if substtree=true if also stored in the object (for a future fit for example)</li>
<li>frac : must be 0 &lt; frac &lt;= 1. It selects only the first frac*100% of the events in the initial dataset.</li>
<li>addFunc(TreeReader *, TTree *, bool)</li>
</ul>
<p>You may define a function to add variables to the tree too. This has to follow the template below. The addFunc is called ones at the beginning of the event loop with 3rd argument = true. And then once per event with 3rd argument = false. The idea is to let you initialise branches and then fill them.</p>
<p>``` void addFunc(TreeReader *reader, TTree *tree, bool reset) { static var1, var2, ...;</p>
<p>if(reset) { // Set branches and initialize stuff } else { //Do stuff } } ```</p>
<h3>Check for multiple cadidates</h3>
<p>``` TTree * CheckMultiple(FUNC_PTR choose=NULL) ```</p>
<p>This goes through the dataset and checks if there are multiple candidates in a single event (looking at the Event and Run numbers). It produces an histogram of #cand per event and returns a tree with a variable "isSingle" added.</p>
<p>==&gt; isSingle is "true" only for 1 candidate per event Normally that candidate is chosen at random (using the already implemented randomKill() function) But you may want to use a different method e.g. the event with best PID. In this case you can pass to the method a function following this template:</p>
<p>``` Long64_t choose (<a class="el" href="classTreeReader.html" title="The class allows to load a ROOT TTree object and easily manipulate information. ">TreeReader</a> * reader, vector&lt; Long64_t &gt; entry ) { //Typycally loop on entry and do something with reader return chosen_entry; // return the number of the selected candidate } ```</p>
<h3>RooDataSet * CreateDataSet()</h3>
<p>This function simply used the information in the <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> object to produce a RooDataSet which then you can use. N.B.: By default the RooDataSet will contain only the observable you specified in the constructor. If you want it to include more variables you can do it by using</p>
<p>``` Analysis::addVariable(name) ```</p>
<p>Example:</p>
<p>``` RooRealVar * MM = new RooRealVar("MM","MM",5300,5000,6000); <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("my_ana","B0","myB0tree","myfile",MM); ana-&gt;addVariable("Jpsi_MM"); ana-&gt;Initialize(""); RooDataSet * ana-&gt;GetDataSet(); ```</p>
<p>Notice that for fitting it is not necessary to get the dataset. All is done automatically. This is just in case you want to do something with the dataset by yourself.</p>
<h4>Scaling and units</h4>
<p>Two functions are provided to set units. One is just SetUnits(string,factor)</p>
<p>e.g. <code>ana-&gt;SetUnits("MeV")</code> &mdash;&gt; A label [MeV] will appear on the axis If factor is not specified then factor = 1 and nothing happens If factor != 1 (<code>ana-&gt;SetUnits("MeV",0.01)</code>) then the first time that one creates the DataSet (initializes) a new observable is created by rescaling each entry by the factor. This may take some time but just once.</p>
<p>An other function is also provided which finds the factor for you.</p>
<p>e.g. <code>ana-&gt;SetUnits("MeV","GeV")</code> means that the input data is in MeV and you want the output plots in GeV So the dataset will be scaled by 1000 and "GeV/#it{c}^{2}" sill be used as label</p>
<h3>Blinding</h3>
<p>You can perform blind analysis by using</p>
<p>``` ana-&gt;SetBlindRegion(min,max). ```</p>
<p>The plots will be blinded in that region (can also be more than one blind interval). Be aware that data is not removed and does contribute in the fit. It's just not shown. Since data contributes parameters of the fit and yields will be hidden and the chi2 as well. If you need more than one region be careful to add them in sequence from low to high and also to check that they don't overlap.</p>
<h3>Generate events</h3>
<p>You can also creare an analysis with an empty constructor and then set a model, initialise, and generate a MC dataset. Two functions are provided Generate(...). One produces a definite total number of events (sig + bkg). The other instead produced a specific number of sig and total bkg. If you just need to generate signal (n background) a quick constructor is provided. </p><pre class="fragment"> ```
</pre><p> <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> *toy = <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("toy", MM); toy-&gt;SetSignal(...); toy-&gt;addBkgComponent(...) toy-&gt;Initialize(""); toy-&gt;Generate(50,100); //50 signal and 100 bkg ```</p>
<p>If you do not have background but one single PDF (e.g. I want to generate a gaussian distribution) then you can use directly a dedicated contructor.</p>
<p>``` <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> (TString _name, RooRealVar *_var, RooAbsPdf *pdf=NULL, int ngen=1000, string opt="-subtree") ``` Example</p>
<p><code> <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> *toy = <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("toy", MM, "Gauss-m[5000]-s[20]", 1000);</code> toy-&gt;Fit(); ```</p>
<p>Not even need to be intialized in this case: all is automatic!</p>
<p>Using Generate() you can use a couple of useful options:</p><ul>
<li>seed(n) -&gt; were n will be used as seed (by default TRndom3(0) is used but this makes things not reproducible)</li>
<li>smear(r) -&gt; "r" is a double interpreted as resolution. The generator will perform a gaussian smearing. Namely for each number generated following the given PDF this will not be directly stored. But a second random number will be generated normally distributed with sigma = r and mean at the first value.</li>
</ul>
<h3>Just one example</h3>
<p>``` <a class="el" href="classTreeReader.html" title="The class allows to load a ROOT TTree object and easily manipulate information. ">TreeReader</a> * reader = new <a class="el" href="classTreeReader.html" title="The class allows to load a ROOT TTree object and easily manipulate information. ">TreeReader</a>("mytree"); reader-&gt;AddFile("file1.root"); reader-&gt;AddFile("file2.root"); // I had here to add 2 files. It it's only one you can give directly name // of tree and file to the <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> constructor</p>
<p>RooRealVar * MM = new RooRealVar("MM","MM",5300,5000,6000); <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("Bs2MM", "B_{s}#rightarrow#mu#mu", reader, "", MM); TCut cuts = "somecuts";</p>
<p>ana-&gt;SetSignal("DCB-Xm[3283]"); ana-&gt;SetSignal("Combinatorial","Exp-b[-0.005,-0.03,0.01]"); ana-&gt;Initialize(""); ana-&gt;applyCuts(cuts); ana-&gt;Fit(5300,5800,50,true,"-minos-quiet") </p><h2>``` </h2>
<h2>PART 3 - Simultaneous fits</h2>
<p>The <a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a> class is available to make simultaneous fits. Almost all you need to know you learnt in the previous parts. In fact to use the <a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a> you need to create you <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> objects first and then give them to the <a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a> object using the AddCategory() function. Finally, you can use the SimultaousFit() function to fit.</p>
<p>e.g.</p>
<p>``` <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana1 = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>(...); ana1-&gt;SetSignal(...); ... <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana2 = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>(...); ana2-&gt;SetSignal(...); ...</p>
<p><a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a> * multiana = new <a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a>("somename"); multiana-&gt;AddCategory(ana1,"name_for_ana1"); multiana-&gt;AddCategory(ana2,"name_for_ana2"); multiana-&gt;SimultaneousFit(); ```</p>
<p>Notice that: 1) The two analysis object do not have to have the same variable 2) The two analysis objects do not need to have the same sample</p>
<p>For example you can take 2 variables from the same sample to make a multudimensional fit or 2 separate samples to fit different tipes of events at the same time. While you specify the models you can assign shared parameters. Custom functions such ad SetUniqueSignal() are available which create automatically the <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> object for the special cases in which for example all samples are supposed to have the same signal function.</p>
<h4>Examples with shared parameters</h4>
<p>In this specific example the same variable is fit from 2 independent samples and the same function is fit on both with all same shape parameters but separate yields.</p>
<p>``` RooRealVar * MM = new RooRealVar("MM","mass",min,max) <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana1 = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("MyCoolAnalyser1","B0","mytree","myfile"); ana1-&gt;SetSignal("DCB"); ana1-&gt;addBkgComponent("Combinatorial","Exp"); ana1-&gt;Initialize("");</p>
<p>// Str2VarMap is a c++ map object that maps a function parameters to their names // You can use it for examples as pars["m"]-&gt;getVal() or ((RooRealVar *)pars["m"])-&gt;setConstant(). //Notice that the elements of the map are RooAbsReal namely RooRealVar or RooFormulaVar. //Therefore for some purposes you need to cast. Str2VarMap pars = ana1-&gt;GetSigParams();</p>
<p><a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana2 = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("MyCoolAnalyser2","B0","mytree2","myfile2"); ana2-&gt;SetSignal("DCB",0,"",pars); // Here is the key point for sharing. // This function get as arguments: model, numer of events to begin // with (0 is default), options and parameters to use. In this case // all the shape parameters of the first Analsys object.</p>
<p><a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a> * multiana = new <a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a>("somename"); multiana-&gt;AddCategory(ana1,"name_for_ana1"); multiana-&gt;AddCategory(ana2,"name_for_ana2"); multiana-&gt;SimultaneousFit(); ```</p>
<p>In this second example the shape parameters are independent but the yields of the two samples are linked. Say that you what to fit 2 samples of Downstream and Long candidates. But the decay is the same so its branching ratio should be common.</p>
<p>``` RooRealVar * BR = new RooRealVar("BR","BR(B^0#rightarrow\mu\mu)",min,max) RooAbsReal * NLong = new RooFormulaVar("NLong",Form("BR * %f",my_long_efficiency),RooArgSet( * BR)); RooAbsReal * NDown = new RooFormulaVar("NDown",Form("BR * %f",my_down_efficiency),RooArgSet( * BR)); // Two yields are defined as a function of a common BR</p>
<p>RooRealVar * MM = new RooRealVar("MM","mass",min,max) <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana1 = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("Down","B0","mytree","myfile"); ana1-&gt;SetSignal("DCB",NDown); // I explicitely tell the object to you my RooFormulaVar for the yield ana1-&gt;addBkgComponent("Combinatorial","Exp");</p>
<p><a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a> * ana2 = new <a class="el" href="classAnalysis.html" title="Allows to handle data starting from TTree or TH1 allows to make cuts and check for multiple candidate...">Analysis</a>("Long","B0","mytree2","myfile2"); ana2-&gt;SetSignal("DCB",NLong); // Long is connected to Down though the BR! ana2-&gt;addBkgComponent("Combinatorial","Exp");</p>
<p><a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a> * multiana = new <a class="el" href="classMultiAnalysis.html" title="This class can be used to do simultaneous fits to more than 1 sample (in 1D)  Can also be used fittin...">MultiAnalysis</a>("somename"); multiana-&gt;AddCategory(ana1,"name_for_ana1"); multiana-&gt;AddCategory(ana2,"name_for_ana2"); multiana-&gt;SimultaneousFit(); ```</p>
<hr/>
<h2>PART 4 - After fitting: other useful methods</h2>
<p>After fitting you can extract information!!</p>
<ul>
<li>GetNSig() -&gt; sig yield in a given interval</li>
<li>GetNBkgVal() -&gt; bkg yield in a given interval</li>
<li>PrintComposition() -&gt; Prints the fraction N_i/N_tot of each component in any given intervals</li>
<li>GetSOverB() -&gt; returns S/B in a given interval</li>
<li>GetSigFraction() -&gt; returns S/(S+B) in a given interval</li>
<li>GetReducedSWeight(x) -&gt; returns S(x)/(S(x) + B(x)) at a point</li>
<li>GetParams() -&gt; Returns a Str2VarMap containing all parmeters of the model including yield</li>
<li>GetSigparams() -&gt; Returns a Str2VarMap containing all parmeters of the signal PDF (excluding yield)</li>
<li>PrintChi2() -&gt; Prints chi2 you can use GetChi2() to have chi2/NDF and GetNDF to have NDF</li>
<li>CalcSWeight() -&gt; Will return a tree same as the stored tree with 2 variables added sW and sWR sW is the proper sWeight and sWR is the reduced SWeight (simpy S(x) / (S(x) + B(x)))</li>
<li>and much else (see doxygen) </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 16 2016 13:49:50 for Tools EasyAnalysis by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
