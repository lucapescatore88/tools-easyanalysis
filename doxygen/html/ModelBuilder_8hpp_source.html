<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Tools EasyAnalysis: tools-easyanalysis/analysis/ModelBuilder.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tools EasyAnalysis
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_83bf2c747ff5b7a7ddb506ca1f75317f.html">tools-easyanalysis</a></li><li class="navelem"><a class="el" href="dir_fd5e4151124d2c6cb8f207c7a58518be.html">analysis</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ModelBuilder.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef MODEL_BUILDER_HPP</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#define MODEL_BUILDER_HPP</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;ReadTree_comp.hpp&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;general_functions.hpp&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;ModelBuilder_helpfunctions.hpp&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="classModelBuilder.html">   18</a></span>&#160;<span class="keyword">class </span><a class="code" href="classModelBuilder.html">ModelBuilder</a> {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordtype">bool</span> isvalid;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordtype">bool</span> doNegSig, doNegBkg;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keyword">protected</span>:</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">string</span> pmode;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    TString name;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    RooRealVar * var;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    vector&lt;RooRealVar *&gt; vars; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    RooAbsPdf * model;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    RooAbsPdf * sig;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    RooAbsPdf * bkg;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    RooAbsReal * nsig;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    RooAbsReal * nbkg;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    vector &lt;RooAbsPdf *&gt; bkg_components;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    vector &lt;RooAbsReal *&gt; bkg_fractions;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    RooRealVar * tmpvar;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordtype">bool</span> totBkgMode;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    TString title;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    vector&lt;Color_t&gt; mycolors;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">void</span> ForceValid() { isvalid = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a0dc98e0b0e6dc50f92205808aa5f5158">   45</a></span>&#160;    RooAbsPdf * <a class="code" href="classModelBuilder.html#a0dc98e0b0e6dc50f92205808aa5f5158">StringToPdf</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * typepdf, <span class="keyword">const</span> <span class="keywordtype">char</span> * namepdf, Str2VarMap mypars, RooRealVar * myvar = NULL)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">if</span>(!myvar) myvar = var; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">return</span> stringToPdf(typepdf, namepdf, myvar, mypars, pmode);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a94efa8982b7fdbcebe94e57dd818365e">   71</a></span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * <a class="code" href="classModelBuilder.html#a94efa8982b7fdbcebe94e57dd818365e">getPdf</a>(T * _base, <span class="keyword">const</span> <span class="keywordtype">char</span> * _name, Str2VarMap mypars = Str2VarMap(), <span class="keywordtype">string</span> weight = <span class="stringliteral">&quot;&quot;</span>, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, RooRealVar * myvar = NULL)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordtype">string</span> t = <span class="keyword">typeid</span>(T).name();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        RooAbsPdf * res = NULL;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">if</span>(!myvar) myvar = var;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">if</span>((t.find(<span class="stringliteral">&quot;c&quot;</span>)!=string::npos &amp;&amp; t.length()==1) || t.find(<span class="stringliteral">&quot;TString&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            res = (RooAbsPdf*)StringToPdf((<span class="keyword">const</span> <span class="keywordtype">char</span> *)_base, _name, mypars, myvar);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(t.find(<span class="stringliteral">&quot;RooAbsPdf&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            res = (RooAbsPdf*)_base;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">if</span>(t.find(<span class="stringliteral">&quot;vector&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                RooArgList * pdfList = <span class="keyword">new</span> RooArgList(<span class="stringliteral">&quot;pdfList_&quot;</span>+name);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                RooArgList * fracList = <span class="keyword">new</span> RooArgList(<span class="stringliteral">&quot;fracPdfList_&quot;</span>+name);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                vector&lt;RooAbsPdf *&gt; * myv = (vector&lt;RooAbsPdf *&gt; *)_base;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e = 0; e &lt; myv-&gt;size(); e++)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                    RooRealVar * f  = <span class="keyword">new</span> RooRealVar((<span class="stringliteral">&quot;f_&quot;</span>+(<span class="keywordtype">string</span>)((*myv)[e]-&gt;GetName())).c_str(),<span class="stringliteral">&quot;f&quot;</span>,0.1,0.,1.);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    pdfList-&gt;add(*(*myv)[e]);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <span class="keywordflow">if</span>(e&gt;0)fracList-&gt;add(*f);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                res = <span class="keyword">new</span> RooAddPdf(<span class="stringliteral">&quot;totpdf_&quot;</span>+name,<span class="stringliteral">&quot;totpdf_&quot;</span>+name,*pdfList,*fracList);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            res-&gt;SetName(_name);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(t.find(<span class="stringliteral">&quot;TTree&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        {   </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            RooArgSet * vars = <span class="keyword">new</span> RooArgSet(*myvar);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">if</span>(opt.find(<span class="stringliteral">&quot;-v[&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordtype">size_t</span> pos = opt.find(<span class="stringliteral">&quot;-v[&quot;</span>) + 2; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="keywordtype">size_t</span> posend = opt.find(<span class="stringliteral">&quot;]&quot;</span>,pos);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">while</span>(<span class="keyword">true</span>)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    <span class="keywordtype">size_t</span> pos2 = opt.find(<span class="stringliteral">&quot;,&quot;</span>,pos+1);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    TString vname = (TString)opt.substr(pos+1,pos2-pos-1);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="keywordflow">if</span>(pos2 &gt;= posend) vname.ReplaceAll(<span class="stringliteral">&quot;]&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    vars-&gt;add(*(<span class="keyword">new</span> RooRealVar(vname,vname,0.)));</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    <span class="keywordflow">if</span>(pos2 &lt; posend) pos = pos2;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            RooDataSet * sigDataSet = NULL;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span>(weight!=<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                vars-&gt;add(*(<span class="keyword">new</span> RooRealVar(weight.c_str(),weight.c_str(),0.)));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                sigDataSet = <span class="keyword">new</span> RooDataSet((TString)_name+<span class="stringliteral">&quot;_DataSet_&quot;</span>+name,<span class="stringliteral">&quot;&quot;</span>,(TTree*)_base,*vars,0,weight.c_str());</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keywordflow">else</span> sigDataSet = <span class="keyword">new</span> RooDataSet((TString)_name+<span class="stringliteral">&quot;_DataSet_&quot;</span>+name,<span class="stringliteral">&quot;&quot;</span>,(TTree*)_base,*vars);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keywordflow">if</span>(opt.find(<span class="stringliteral">&quot;-c[&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="keywordtype">size_t</span> pos = opt.find(<span class="stringliteral">&quot;-c[&quot;</span>) +3; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordtype">size_t</span> posend = opt.find(<span class="stringliteral">&quot;]&quot;</span>,pos);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                TString treecut = (TString)(opt.substr( pos, posend - pos));</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                sigDataSet-&gt;Print();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                sigDataSet-&gt;reduce(treecut);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="keywordflow">if</span>(opt.find(<span class="stringliteral">&quot;-rho&quot;</span>)!=string::npos) </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="keywordtype">int</span> pos = opt.find(<span class="stringliteral">&quot;-rho&quot;</span>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="keywordtype">string</span> rhostr = opt.substr(pos+4,20);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="keywordtype">double</span> rho = ((TString)rhostr).Atof();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                res = <span class="keyword">new</span> RooKeysPdf((TString)_name,_name,*myvar,*sigDataSet,RooKeysPdf::MirrorBoth,rho);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordflow">else</span> res = <span class="keyword">new</span> RooKeysPdf((TString)_name,_name,*myvar,*sigDataSet,RooKeysPdf::MirrorBoth,2);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span>(opt.find(<span class="stringliteral">&quot;-print&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                TCanvas * c = <span class="keyword">new</span> TCanvas();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                RooPlot * keysplot = myvar-&gt;frame();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                sigDataSet-&gt;plotOn(keysplot);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                res-&gt;plotOn(keysplot);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                keysplot-&gt;SetTitle(_name);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                keysplot-&gt;Draw();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                c-&gt;Print(<span class="stringliteral">&quot;rooKeysModel_&quot;</span>+((TString)_name).ReplaceAll(<span class="stringliteral">&quot;__noprint__&quot;</span>,<span class="stringliteral">&quot;&quot;</span>)+<span class="stringliteral">&quot;.pdf&quot;</span>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                <span class="keyword">delete</span> c;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                <span class="keyword">delete</span> keysplot;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(t.find(<span class="stringliteral">&quot;TH1&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            RooDataHist * sigDataHist = <span class="keyword">new</span> RooDataHist((TString)_name+<span class="stringliteral">&quot;_DataHist&quot;</span>+name,<span class="stringliteral">&quot;&quot;</span>,*myvar,(TH1*)_base,6);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            res = <span class="keyword">new</span> RooHistPdf((TString)_name,_name,*myvar,*sigDataHist);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="keywordflow">if</span>(((<span class="keywordtype">string</span>)_name).find(<span class="stringliteral">&quot;_noprint&quot;</span>)!=string::npos) cout &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;: ATTANTION:_noprint option in background name: component won&#39;t be added to background list&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="keywordflow">else</span> cout &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;: ***** ATTANTION: Wrong type (&quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;) given to getPdf. Only string, RooAbsPdf, vector&lt;RooAbsPdf *&gt;, TTree and TH1 are allowed! *****&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">//Constructors</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="classModelBuilder.html">ModelBuilder</a>():</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        isvalid(false), doNegSig(false), doNegBkg(false), var(NULL), sig(NULL), bkg(NULL), totBkgMode(false), mycolors(vector&lt;Color_t&gt;())</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        nsig = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;nsig&quot;</span>,<span class="stringliteral">&quot;nsig&quot;</span>,0.,0.,1.e8);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        nbkg = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;nbkg&quot;</span>,<span class="stringliteral">&quot;nbkg&quot;</span>,0.,0.,1.e8);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        name = <span class="stringliteral">&quot;model&quot;</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        title = name;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="classModelBuilder.html">ModelBuilder</a>(TString _name, RooRealVar * _var):</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        isvalid(false), doNegSig(false), doNegBkg(false), name(_name), var(_var), sig(NULL), bkg(NULL), totBkgMode(false), mycolors(vector&lt;Color_t&gt;())</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span>(var)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">if</span>( ((<span class="keywordtype">string</span>)var-&gt;GetTitle()).find(<span class="stringliteral">&quot;__var__&quot;</span>)==string::npos )</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                var-&gt;SetTitle( (TString)var-&gt;GetTitle()+<span class="stringliteral">&quot;__var__&quot;</span> );</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            tmpvar = <span class="keyword">new</span> RooRealVar(*var); vars.push_back(var); </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        nsig = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;nsig_&quot;</span>+name,<span class="stringliteral">&quot;nsig&quot;</span>,0.,0.,1.e8);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        nbkg = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;nbkg_&quot;</span>+name,<span class="stringliteral">&quot;nbkg&quot;</span>,0.,0.,1.e8);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        title = name;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    ~<a class="code" href="classModelBuilder.html">ModelBuilder</a>()</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keyword">delete</span> var;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keyword">delete</span> model;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keyword">delete</span> sig;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keyword">delete</span> bkg;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keyword">delete</span> nsig;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keyword">delete</span> nbkg;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i = 0; i &lt; bkg_components.size(); i++)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keyword">delete</span> bkg_components[i];</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keyword">delete</span> bkg_fractions[i];</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">//Methods</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    RooAbsPdf * Initialize(<span class="keywordtype">string</span> optstr = <span class="stringliteral">&quot;-exp&quot;</span>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="classModelBuilder.html#af116e5388b52083d61b34e4c7bcbc0ab">  246</a></span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * <a class="code" href="classModelBuilder.html#af116e5388b52083d61b34e4c7bcbc0ab">AddBkgComponent</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * _name, T * _comp, RooAbsReal * _frac, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, Str2VarMap myvars = Str2VarMap(), <span class="keywordtype">string</span> weight = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">if</span>(!sig) { cout &lt;&lt; <span class="stringliteral">&quot;ATTENTION: Signal not set! Set the signal before any background!&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> NULL; }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        TString nstr = <span class="stringliteral">&quot;bkg_&quot;</span>+(TString)_name;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordtype">string</span> lowopt = opt;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        transform(lowopt.begin(), lowopt.end(), lowopt.begin(), ::tolower);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        RooAbsReal * frac = NULL;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        nstr+=(<span class="stringliteral">&quot;_&quot;</span>+name);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span>(opt.find(<span class="stringliteral">&quot;-frac&quot;</span>)!=string::npos) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            TString ss( (TString)nsig-&gt;GetName() + <span class="stringliteral">&quot; * &quot;</span> + _frac-&gt;GetName() );</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            frac = <span class="keyword">new</span> RooFormulaVar(<span class="stringliteral">&quot;n&quot;</span>+nstr,<span class="stringliteral">&quot;f_{&quot;</span>+(TString)_name+<span class="stringliteral">&quot;}^{wrtsig}&quot;</span>,ss,RooArgSet(*_frac,*nsig));</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">else</span> { frac = _frac; }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        frac-&gt;SetName((TString)frac-&gt;GetName()+<span class="stringliteral">&quot;_&quot;</span>+name);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        nstr += <span class="stringliteral">&quot;__for_&quot;</span> + (TString)var-&gt;GetName();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        RooAbsPdf * comp = getPdf(_comp,nstr,myvars,weight,opt);    </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span>(comp!=NULL &amp;&amp; _frac != NULL &amp;&amp; lowopt.find(<span class="stringliteral">&quot;-nofit&quot;</span>)==string::npos)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">if</span>(lowopt.find(<span class="stringliteral">&quot;-ibegin&quot;</span>)==string::npos)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                bkg_components.push_back(comp);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                bkg_fractions.push_back(frac);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                SetLastBkgColor(GetDefaultColors()[bkg_components.size()-1]);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                bkg_components.insert(bkg_components.begin(),comp);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                bkg_fractions.insert(bkg_fractions.begin(),frac);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                mycolors.insert(mycolors.begin(),GetDefaultColors()[bkg_components.size()-1]);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">return</span> comp;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * AddBkgComponent(<span class="keyword">const</span> <span class="keywordtype">char</span> * _name, T * _comp, <span class="keywordtype">double</span> _frac = 0, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, Str2VarMap myvars = Str2VarMap(), <span class="keywordtype">string</span> weight = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span>(!sig) { cout &lt;&lt; <span class="stringliteral">&quot;ATTENTION: Signal not set! Set the signal before any background!&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> NULL; }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        TString nstr = <span class="stringliteral">&quot;bkg_&quot;</span>+(TString)_name;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        RooAbsReal * frac = NULL;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordtype">double</span> val = TMath::Abs(_frac);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">if</span>(val == 0) val = 1e3;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordtype">double</span> min = 0;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span>(doNegBkg) min = -3 * TMath::Sqrt(val);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordtype">double</span> max = 1.e7;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">if</span>(_frac &lt; 0) { min = val; max = val; }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">if</span>(totBkgMode) </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keywordflow">if</span>(val &gt; 1) { cout &lt;&lt; <span class="stringliteral">&quot;Attention in &#39;totBkgMode&#39; the nevt must be between 0 and 1&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> NULL; }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            frac = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;f&quot;</span>+nstr,<span class="stringliteral">&quot;f_{&quot;</span>+(TString)_name+<span class="stringliteral">&quot;}&quot;</span>,val,0,1);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>((TMath::Abs(_frac) &gt; 0 &amp;&amp; TMath::Abs(_frac) &lt;= 1) || opt.find(<span class="stringliteral">&quot;-frac&quot;</span>)!=string::npos)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            TString ss( (TString)nsig-&gt;GetName() + Form(<span class="stringliteral">&quot; * %e&quot;</span>, val) );</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">if</span>(!nsig) { cout &lt;&lt; <span class="stringliteral">&quot;Attention if you use this option abs(nevt) &lt; 1 you must set the signal first.&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> NULL; }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            frac = <span class="keyword">new</span> RooFormulaVar(<span class="stringliteral">&quot;n&quot;</span>+nstr,<span class="stringliteral">&quot;f_{&quot;</span>+(TString)_name+<span class="stringliteral">&quot;}^{wrtsig}&quot;</span>,ss,*nsig);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">else</span> frac = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;n&quot;</span>+nstr,<span class="stringliteral">&quot;N_{&quot;</span>+(TString)_name+<span class="stringliteral">&quot;}&quot;</span>,val,min,max);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">return</span> AddBkgComponent(_name, _comp, frac, opt, myvars, weight);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * AddBkgComponent(<span class="keyword">const</span> <span class="keywordtype">char</span> * _name, T * _comp, RooAbsReal * _frac, <span class="keywordtype">string</span> opt, <span class="keywordtype">string</span> weight, Str2VarMap myvars = Str2VarMap())</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">return</span> AddBkgComponent(_name, _comp, _frac, opt, myvars, weight);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * AddBkgComponent(<span class="keyword">const</span> <span class="keywordtype">char</span> * _name, T * _comp, <span class="keywordtype">double</span> _frac, <span class="keywordtype">string</span> opt, <span class="keywordtype">string</span> weight, Str2VarMap myvars = Str2VarMap())</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">return</span> AddBkgComponent(_name, _comp, _frac, opt, myvars, weight);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * SetExtraBkgDimension(<span class="keyword">const</span> <span class="keywordtype">char</span> * _name, T * _pdf, RooRealVar * extravar, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, Str2VarMap myvars = Str2VarMap(), <span class="keywordtype">string</span> weight = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordtype">int</span> ind = -1;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bb = 0; bb &lt; bkg_components.size(); bb++)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">if</span>( ((<span class="keywordtype">string</span>)bkg_components[bb]-&gt;GetName()).find(_name) != string::npos )</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                ind = bb;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">if</span>(ind==-1) { cout &lt;&lt; <span class="stringliteral">&quot;You must set a background component with the specified name using AddBkgComponent() first&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> NULL; }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        RooAbsPdf * old_bkg = bkg_components[ind];</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        TString pdfname   = ((TString)old_bkg-&gt;GetName()).ReplaceAll(<span class="stringliteral">&quot;__noprint__&quot;</span>,<span class="stringliteral">&quot;&quot;</span>); </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordtype">size_t</span> posfor = ((string)pdfname).find(<span class="stringliteral">&quot;__for&quot;</span>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        TString name_comp = ((string)pdfname).substr(0,posfor)+<span class="stringliteral">&quot;__for_&quot;</span>+(TString)extravar-&gt;GetName()+<span class="stringliteral">&quot;__noprint__&quot;</span>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        TString name_tot  = pdfname+<span class="stringliteral">&quot;__and_&quot;</span>+(TString)extravar-&gt;GetName();</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        old_bkg-&gt;SetName(pdfname+<span class="stringliteral">&quot;__noprint__&quot;</span>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        RooAbsPdf * new_comp = getPdf(_pdf, name_comp, myvars, weight, opt, extravar);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        bkg_components[ind] = <span class="keyword">new</span> RooProdPdf(<span class="stringliteral">&quot;prod&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,*old_bkg,*new_comp);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        bkg_components[ind]-&gt;SetName(name_tot);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        bkg_components[ind]-&gt;SetTitle(name_tot);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">return</span> bkg_components[ind];</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * SetExtraBkgDimension(<span class="keyword">const</span> <span class="keywordtype">char</span> * _name, T * _pdf, RooRealVar * extravar, <span class="keywordtype">string</span> opt, <span class="keywordtype">string</span> weight, Str2VarMap myvars = Str2VarMap())</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">return</span> SetExtraBkgDimension(_name, _pdf, extravar, opt, myvars, weight);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a7c67969b6fc2b075649773f3a7c7e38b">  372</a></span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * <a class="code" href="classModelBuilder.html#a7c67969b6fc2b075649773f3a7c7e38b">SetSignal</a>(T * _sig, RooAbsReal * _nsig, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, Str2VarMap myvars = Str2VarMap(), <span class="keywordtype">string</span> weight = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordtype">string</span> lowopt = opt;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        transform(lowopt.begin(), lowopt.end(), lowopt.begin(), ::tolower);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        ResetVariable();</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        TString myname = <span class="stringliteral">&quot;_&quot;</span> + name;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        nsig = _nsig;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        nsig-&gt;SetName((TString)nsig-&gt;GetName()+myname);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        myname += <span class="stringliteral">&quot;__for_&quot;</span> + (TString)var-&gt;GetName();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span>(_sig) </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            sig = getPdf(_sig,<span class="stringliteral">&quot;sig&quot;</span>+myname, myvars, weight, opt);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            sig-&gt;SetName(<span class="stringliteral">&quot;totsig&quot;</span>+myname);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            sig-&gt;SetTitle(<span class="stringliteral">&quot;totsig&quot;</span>+myname);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">return</span> sig;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * SetSignal(T * _sig, <span class="keywordtype">double</span> _nsig = 0, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, Str2VarMap myvars = Str2VarMap(), <span class="keywordtype">string</span> weight = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        RooAbsReal * tmpnsig = NULL;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordtype">double</span> val = TMath::Abs(_nsig);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">if</span>(val == 0) val = 1e3;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordtype">double</span> min = 0;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">if</span>(doNegSig) min = -3 * TMath::Sqrt(val);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordtype">double</span> max = 1.e7;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">if</span>(_nsig &lt; 0) { min = val; max = val; }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">if</span>(TMath::Abs(_nsig) &gt; 0 &amp;&amp; TMath::Abs(_nsig) &lt;= 1) tmpnsig = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;nsig&quot;</span>,<span class="stringliteral">&quot;N_{sig}&quot;</span>,val*max,min,max);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">else</span> tmpnsig = <span class="keyword">new</span> RooRealVar(<span class="stringliteral">&quot;nsig&quot;</span>,<span class="stringliteral">&quot;N_{sig}&quot;</span>,val,min,max);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">return</span> SetSignal(_sig,tmpnsig,opt,myvars, weight);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * SetSignal(T * _sig, RooAbsReal * _nsig, <span class="keywordtype">string</span> opt, <span class="keywordtype">string</span> weight, Str2VarMap myvars = Str2VarMap())</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">return</span> SetSignal(_sig,_nsig,opt,myvars, weight);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * SetSignal(T * _sig, <span class="keywordtype">double</span> _nsig, <span class="keywordtype">string</span> opt, <span class="keywordtype">string</span> weight, Str2VarMap myvars = Str2VarMap())</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">return</span> SetSignal(_sig,_nsig,opt,myvars, weight);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * SetExtraSignalDimension(T * _sig, RooRealVar * extravar, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, Str2VarMap myvars = Str2VarMap(), <span class="keywordtype">string</span> weight = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">if</span>(!sig) { cout &lt;&lt; <span class="stringliteral">&quot;You must set the signal using SetSignal() first&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> NULL; }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        RooAbsPdf * old_sig = sig;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        TString pdfname = ((TString)sig-&gt;GetName()).ReplaceAll(<span class="stringliteral">&quot;__noprint__&quot;</span>,<span class="stringliteral">&quot;&quot;</span>).ReplaceAll(<span class="stringliteral">&quot;totsig&quot;</span>,<span class="stringliteral">&quot;sig&quot;</span>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordtype">size_t</span> posfor = ((string)pdfname).find(<span class="stringliteral">&quot;__for&quot;</span>);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        TString name_comp = ((string)pdfname).substr(0,posfor)+<span class="stringliteral">&quot;__for_&quot;</span>+(TString)extravar-&gt;GetName()+<span class="stringliteral">&quot;__noprint__&quot;</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        TString name_tot = pdfname+<span class="stringliteral">&quot;__and_&quot;</span>+(TString)extravar-&gt;GetName();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        sig-&gt;SetName(pdfname+<span class="stringliteral">&quot;__noprint__&quot;</span>);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        RooAbsPdf * new_comp = getPdf(_sig, name_comp, myvars, weight, opt, extravar);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        sig = <span class="keyword">new</span> RooProdPdf(<span class="stringliteral">&quot;prod&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,*old_sig,*new_comp);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        sig-&gt;SetName(name_tot);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        sig-&gt;SetTitle(name_tot);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">return</span> sig;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; RooAbsPdf * SetExtraSignalDimension(T * _sig, RooRealVar * extravar, <span class="keywordtype">string</span> opt, <span class="keywordtype">string</span> weight, Str2VarMap myvars = Str2VarMap())</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">return</span> SetExtraSignalDimension(_sig, extravar, opt, myvars, weight);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordtype">void</span> AllowNegativeYield(<span class="keywordtype">string</span> option = <span class="stringliteral">&quot;&quot;</span>, <span class="keywordtype">bool</span> cond = <span class="keyword">true</span>) {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      cout &lt;&lt; endl &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;: AllowNegativeYield&quot;</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">if</span> (option.find(<span class="stringliteral">&quot;sig&quot;</span>) != string::npos)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      doNegSig = cond;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="keywordflow">if</span> (doNegSig) cout &lt;&lt; <span class="stringliteral">&quot; - Signal&quot;</span>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">if</span> (option.find(<span class="stringliteral">&quot;bkg&quot;</span>) != string::npos)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      doNegBkg = cond;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keywordflow">if</span> (doNegBkg) cout &lt;&lt; <span class="stringliteral">&quot; - Backgrounds&quot;</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      cout &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordtype">void</span> SetLastBkgColor(Color_t color) </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordflow">if</span>(mycolors.size() == bkg_components.size()) mycolors[mycolors.size()-1] = color;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">else</span> mycolors.push_back(color); </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    vector &lt;Color_t&gt; GetColors() { <span class="keywordflow">return</span> mycolors; }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">void</span> SetTitle(TString _title) { title = _title; }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a172bfd1385aac97f9f77b8197d01d003">  471</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classModelBuilder.html#a172bfd1385aac97f9f77b8197d01d003">SetVariable</a>(RooRealVar * _var) { var = _var; tmpvar = <span class="keyword">new</span> RooRealVar(*var); }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno"><a class="line" href="classModelBuilder.html#ad27ab1c60ae2deaba1d6034c5739b42f">  477</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classModelBuilder.html#ad27ab1c60ae2deaba1d6034c5739b42f">SetBkgMode</a>( <span class="keywordtype">bool</span> mode ) { totBkgMode = mode; }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordtype">void</span> SetSig(RooAbsPdf * _sig) { sig = _sig; }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordtype">void</span> SetModel(RooAbsPdf * _model);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordtype">void</span> SetNSig(RooAbsReal * _nsig) { nsig = _nsig; }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">void</span> SetBkg(RooAbsPdf * _bkg) { bkg = _bkg; }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordtype">void</span> SetBkg(vector&lt;RooAbsPdf *&gt; _bkg_comp) { bkg_components = _bkg_comp; }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordtype">void</span> SetName(<span class="keyword">const</span> <span class="keywordtype">char</span> * newname) { name = newname; }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordtype">void</span> ClearBkgList() { bkg_components.clear(); bkg_fractions.clear(); }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">void</span> ResetVariable() { var-&gt;setVal(tmpvar-&gt;getVal()); var-&gt;setRange(tmpvar-&gt;getMin(),tmpvar-&gt;getMax()); };</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    RooAbsPdf * GetParamsGaussian(RooFitResult * fitRes);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    RooDataSet * GetParamsVariations(<span class="keywordtype">int</span> nvariations = 10000, RooFitResult * fitRes = NULL);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordtype">bool</span> isValid() { <span class="keywordflow">return</span> isvalid; }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">//bool isExtended() { return extended; }</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    TString GetName() { <span class="keywordflow">return</span> name; }</div>
<div class="line"><a name="l00496"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a44aed339508121a8eb5363b839f1141d">  496</a></span>&#160;    RooRealVar * <a class="code" href="classModelBuilder.html#a44aed339508121a8eb5363b839f1141d">GetVariable</a>() { <span class="keywordflow">return</span> var; }</div>
<div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a855edb1a1a7f03109ab595b21886fcab">  498</a></span>&#160;    RooAbsPdf * <a class="code" href="classModelBuilder.html#a855edb1a1a7f03109ab595b21886fcab">GetModel</a>() { <span class="keywordflow">return</span> model; }</div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a1e62593e81e647735ecaa9b93b3abc11">  500</a></span>&#160;    RooAbsPdf * <a class="code" href="classModelBuilder.html#a1e62593e81e647735ecaa9b93b3abc11">GetSig</a>() { <span class="keywordflow">return</span> sig; }</div>
<div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a8a8546f348f5487391d53bc5def411d1">  502</a></span>&#160;    RooAbsPdf * <a class="code" href="classModelBuilder.html#a8a8546f348f5487391d53bc5def411d1">GetTotBkg</a>() { <span class="keywordflow">return</span> bkg; }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordtype">double</span> GetNBkgVal(<span class="keywordtype">double</span> min = 0, <span class="keywordtype">double</span> max = 0, <span class="keywordtype">double</span> * valerr = NULL, RooFitResult * fitRes = NULL);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">double</span> GetNSigVal(<span class="keywordtype">double</span> min = 0, <span class="keywordtype">double</span> max = 0, <span class="keywordtype">double</span> * valerr = NULL, RooFitResult * fitRes = NULL, <span class="keywordtype">double</span> fmin = 0, <span class="keywordtype">double</span> fmax = 0);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">double</span> GetSOverB(<span class="keywordtype">float</span> min, <span class="keywordtype">float</span> max, <span class="keywordtype">double</span> * valerr = NULL, RooFitResult * fitRes = NULL);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordtype">double</span> GetSigFraction(<span class="keywordtype">float</span> min, <span class="keywordtype">float</span> max, <span class="keywordtype">double</span> * valerr = NULL, RooFitResult * fitRes = NULL);</div>
<div class="line"><a name="l00514"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a00782f7dd47b1b529426249c7cf613d0">  514</a></span>&#160;    vector&lt;RooAbsPdf *&gt; <a class="code" href="classModelBuilder.html#a00782f7dd47b1b529426249c7cf613d0">GetBkgComponents</a>() { <span class="keywordflow">return</span> bkg_components; }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordtype">void</span> PrintComposition(<span class="keywordtype">float</span> min = 0., <span class="keywordtype">float</span> max = 0., RooFitResult * fitRes = NULL);</div>
<div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a7aa1af35ab3b86b9fdb7508e62c99f1e">  518</a></span>&#160;    vector&lt;RooAbsReal *&gt; <a class="code" href="classModelBuilder.html#a7aa1af35ab3b86b9fdb7508e62c99f1e">GetBkgFractions</a>() { <span class="keywordflow">return</span> bkg_fractions; }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordtype">double</span> GetSigVal(<span class="keywordtype">double</span> * valerr = NULL, RooFitResult * fitRes = NULL);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">double</span> GetSigVal(<span class="keywordtype">double</span> * errHi, <span class="keywordtype">double</span> * errLo); </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordtype">bool</span> CheckModel() { <span class="keywordflow">return</span> checkModel(model); };</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    RooAbsReal * GetTotNBkg();</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    RooAbsPdf * CalcTotBkg();</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    RooAbsReal * GetNSigPtr() { <span class="keywordflow">return</span> nsig; }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    Str2VarMap GetSigParams(<span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    Str2VarMap GetParams(<span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> SetPrintLevel(<span class="keywordtype">string</span> mode) { pmode = mode; }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    RooPlot * Print(TString title = <span class="stringliteral">&quot;&quot;</span>, TString Xtitle = <span class="stringliteral">&quot;&quot;</span>, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, RooAbsData* data = NULL, <span class="keywordtype">int</span> bins = 50, </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            vector&lt;string&gt; regStr = vector&lt;string&gt;(), <span class="keywordtype">double</span> * range = NULL, RooFitResult * fitRes = NULL, </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            TString Ytitle = <span class="stringliteral">&quot;&quot;</span>, RooRealVar * myvar = NULL);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">void</span> Print(TString title = <span class="stringliteral">&quot;&quot;</span>, TString Xtitle = <span class="stringliteral">&quot;&quot;</span>, <span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>, RooAbsData* data = NULL, <span class="keywordtype">int</span> bins = 50, </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            RooFitResult * fitRes = NULL, TString Ytitle = <span class="stringliteral">&quot;&quot;</span>, vector&lt;RooRealVar *&gt; myvar = vector&lt;RooRealVar *&gt;());</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a558f12fcb8f473ed09961a72e1f1ee64">  562</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classModelBuilder.html#a558f12fcb8f473ed09961a72e1f1ee64">PrintParams</a>(<span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>) { PrintPars(GetParams(<span class="stringliteral">&quot;-orignames&quot;</span>), opt); }</div>
<div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a6137f9c3cfb5470807231048dcb73396">  564</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classModelBuilder.html#a6137f9c3cfb5470807231048dcb73396">PrintSigParams</a>(<span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>) { PrintPars(GetSigParams(<span class="stringliteral">&quot;-orignames&quot;</span>), opt); }</div>
<div class="line"><a name="l00566"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a6e07dd66bf4a41ae518843064b507406">  566</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classModelBuilder.html#a6e07dd66bf4a41ae518843064b507406">PrintParamsTable</a>(<span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>) { PrintPars(GetParams(<span class="stringliteral">&quot;-orignames&quot;</span>),<span class="stringliteral">&quot;-latex&quot;</span>+opt); }</div>
<div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="classModelBuilder.html#a9b1e266eb4d736d1b59ce7956172abff">  568</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classModelBuilder.html#a9b1e266eb4d736d1b59ce7956172abff">PrintSigParamsTable</a>(<span class="keywordtype">string</span> opt = <span class="stringliteral">&quot;&quot;</span>) { PrintPars(GetSigParams(<span class="stringliteral">&quot;-orignames&quot;</span>),<span class="stringliteral">&quot;-latex&quot;</span>+opt); }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordtype">float</span> GetReducedSWeight(<span class="keywordtype">float</span> value);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;};</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="ttc" id="classModelBuilder_html_a8a8546f348f5487391d53bc5def411d1"><div class="ttname"><a href="classModelBuilder.html#a8a8546f348f5487391d53bc5def411d1">ModelBuilder::GetTotBkg</a></div><div class="ttdeci">RooAbsPdf * GetTotBkg()</div><div class="ttdoc">Returns a pdf corresponding to the sum of all bkg PDFs. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:502</div></div>
<div class="ttc" id="classModelBuilder_html_a00782f7dd47b1b529426249c7cf613d0"><div class="ttname"><a href="classModelBuilder.html#a00782f7dd47b1b529426249c7cf613d0">ModelBuilder::GetBkgComponents</a></div><div class="ttdeci">vector&lt; RooAbsPdf * &gt; GetBkgComponents()</div><div class="ttdoc">Returns the full list of bkg PDFs. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:514</div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> RooAmorosoPdf.cpp:38</div></div>
<div class="ttc" id="classModelBuilder_html_af116e5388b52083d61b34e4c7bcbc0ab"><div class="ttname"><a href="classModelBuilder.html#af116e5388b52083d61b34e4c7bcbc0ab">ModelBuilder::AddBkgComponent</a></div><div class="ttdeci">RooAbsPdf * AddBkgComponent(const char *_name, T *_comp, RooAbsReal *_frac, string opt=&quot;&quot;, Str2VarMap myvars=Str2VarMap(), string weight=&quot;&quot;)</div><div class="ttdoc">Adds a bkg component. Adds a bkg component named "_name" based on the object "_comp". </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:246</div></div>
<div class="ttc" id="classModelBuilder_html_a44aed339508121a8eb5363b839f1141d"><div class="ttname"><a href="classModelBuilder.html#a44aed339508121a8eb5363b839f1141d">ModelBuilder::GetVariable</a></div><div class="ttdeci">RooRealVar * GetVariable()</div><div class="ttdoc">Return the variable to fit. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:496</div></div>
<div class="ttc" id="classModelBuilder_html_a855edb1a1a7f03109ab595b21886fcab"><div class="ttname"><a href="classModelBuilder.html#a855edb1a1a7f03109ab595b21886fcab">ModelBuilder::GetModel</a></div><div class="ttdeci">RooAbsPdf * GetModel()</div><div class="ttdoc">Returns the model pdf. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:498</div></div>
<div class="ttc" id="classModelBuilder_html_a94efa8982b7fdbcebe94e57dd818365e"><div class="ttname"><a href="classModelBuilder.html#a94efa8982b7fdbcebe94e57dd818365e">ModelBuilder::getPdf</a></div><div class="ttdeci">RooAbsPdf * getPdf(T *_base, const char *_name, Str2VarMap mypars=Str2VarMap(), string weight=&quot;&quot;, string opt=&quot;&quot;, RooRealVar *myvar=NULL)</div><div class="ttdoc">Returns a PDF starting from different kinds of objects This is one of the core function of the ModelB...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:71</div></div>
<div class="ttc" id="classModelBuilder_html_a6137f9c3cfb5470807231048dcb73396"><div class="ttname"><a href="classModelBuilder.html#a6137f9c3cfb5470807231048dcb73396">ModelBuilder::PrintSigParams</a></div><div class="ttdeci">void PrintSigParams(string opt=&quot;&quot;)</div><div class="ttdoc">Prints the sgnal pdf paramters to screen in RooFit format (opt="-nocost" skips constants) ...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:564</div></div>
<div class="ttc" id="classModelBuilder_html_a7aa1af35ab3b86b9fdb7508e62c99f1e"><div class="ttname"><a href="classModelBuilder.html#a7aa1af35ab3b86b9fdb7508e62c99f1e">ModelBuilder::GetBkgFractions</a></div><div class="ttdeci">vector&lt; RooAbsReal * &gt; GetBkgFractions()</div><div class="ttdoc">Returns the full list of bkg yields variables. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:518</div></div>
<div class="ttc" id="classModelBuilder_html_a558f12fcb8f473ed09961a72e1f1ee64"><div class="ttname"><a href="classModelBuilder.html#a558f12fcb8f473ed09961a72e1f1ee64">ModelBuilder::PrintParams</a></div><div class="ttdeci">void PrintParams(string opt=&quot;&quot;)</div><div class="ttdoc">Prints all the paramters to screen in RooFit format (opt="-nocost" skips constants) ...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:562</div></div>
<div class="ttc" id="classModelBuilder_html_a1e62593e81e647735ecaa9b93b3abc11"><div class="ttname"><a href="classModelBuilder.html#a1e62593e81e647735ecaa9b93b3abc11">ModelBuilder::GetSig</a></div><div class="ttdeci">RooAbsPdf * GetSig()</div><div class="ttdoc">Returns the signal pdf. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:500</div></div>
<div class="ttc" id="classModelBuilder_html_a6e07dd66bf4a41ae518843064b507406"><div class="ttname"><a href="classModelBuilder.html#a6e07dd66bf4a41ae518843064b507406">ModelBuilder::PrintParamsTable</a></div><div class="ttdeci">void PrintParamsTable(string opt=&quot;&quot;)</div><div class="ttdoc">Prints all the paramters to screen in latex table format (opt="-nocost" skips constants) ...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:566</div></div>
<div class="ttc" id="classModelBuilder_html_a7c67969b6fc2b075649773f3a7c7e38b"><div class="ttname"><a href="classModelBuilder.html#a7c67969b6fc2b075649773f3a7c7e38b">ModelBuilder::SetSignal</a></div><div class="ttdeci">RooAbsPdf * SetSignal(T *_sig, RooAbsReal *_nsig, string opt=&quot;&quot;, Str2VarMap myvars=Str2VarMap(), string weight=&quot;&quot;)</div><div class="ttdoc">Adds the signal component The behaviour it&#39;s similar to AddBkgComponent(). The only difference is the...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:372</div></div>
<div class="ttc" id="classModelBuilder_html_a172bfd1385aac97f9f77b8197d01d003"><div class="ttname"><a href="classModelBuilder.html#a172bfd1385aac97f9f77b8197d01d003">ModelBuilder::SetVariable</a></div><div class="ttdeci">void SetVariable(RooRealVar *_var)</div><div class="ttdoc">Sets the variable to fit "var". It also creates a copy of the initial variable "tmpvar". In fact when fitting the varible is modified and if you want to fit again or change the model and refit you need to reset the variable as it was. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:471</div></div>
<div class="ttc" id="classModelBuilder_html_a9b1e266eb4d736d1b59ce7956172abff"><div class="ttname"><a href="classModelBuilder.html#a9b1e266eb4d736d1b59ce7956172abff">ModelBuilder::PrintSigParamsTable</a></div><div class="ttdeci">void PrintSigParamsTable(string opt=&quot;&quot;)</div><div class="ttdoc">Prints all sigal PDF paramters to screen in latex table format (opt="-nocost" skips constants) ...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:568</div></div>
<div class="ttc" id="classModelBuilder_html_a0dc98e0b0e6dc50f92205808aa5f5158"><div class="ttname"><a href="classModelBuilder.html#a0dc98e0b0e6dc50f92205808aa5f5158">ModelBuilder::StringToPdf</a></div><div class="ttdeci">RooAbsPdf * StringToPdf(const char *typepdf, const char *namepdf, Str2VarMap mypars, RooRealVar *myvar=NULL)</div><div class="ttdoc">Wrapper for the external function stringToPdf() which returns a model from a string. </div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:45</div></div>
<div class="ttc" id="classModelBuilder_html"><div class="ttname"><a href="classModelBuilder.html">ModelBuilder</a></div><div class="ttdoc">Implements a class which uses RooFit to handel the creation of fit models   - some functions like CB...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:18</div></div>
<div class="ttc" id="classModelBuilder_html_ad27ab1c60ae2deaba1d6034c5739b42f"><div class="ttname"><a href="classModelBuilder.html#ad27ab1c60ae2deaba1d6034c5739b42f">ModelBuilder::SetBkgMode</a></div><div class="ttdeci">void SetBkgMode(bool mode)</div><div class="ttdoc">Sets the background mode Normally the model is built as model = nsig*sig + nbkg1*bkg1 + nbkg2*bkg2 * ...</div><div class="ttdef"><b>Definition:</b> ModelBuilder.hpp:477</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 16 2016 13:49:50 for Tools EasyAnalysis by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
